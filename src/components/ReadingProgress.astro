---
interface Props {
  readingTime: string
}

const { readingTime } = Astro.props
---

<!-- Reading Progress Bar - transparent with pie chart on left -->
<div id="reading-progress-container" class="fixed top-[57px] left-0 right-0 z-40 pointer-events-none opacity-0 transition-opacity duration-300">
  <div class="h-10 bg-background/60 backdrop-blur-md border-b pointer-events-auto">
    <div class="h-full max-w-5xl mx-auto px-4 flex items-center">
      <!-- Pie Chart on Left -->
      <div class="relative w-7 h-7 mr-3">
        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
          <!-- Background circle -->
          <circle 
            cx="18" cy="18" r="15" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="3"
            class="text-muted/30"
          />
          <!-- Progress circle (pie fill) -->
          <circle 
            id="progress-pie"
            cx="18" cy="18" r="15" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="3"
            stroke-linecap="round"
            stroke-dasharray="94.25"
            stroke-dashoffset="94.25"
            class="text-foreground transition-all duration-150"
          />
        </svg>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const container = document.getElementById('reading-progress-container')
    const progressPie = document.getElementById('progress-pie')
    
    if (!container || !progressPie) return
    
    const article = document.querySelector('article.prose')
    if (!article) return
    
    const circumference = 2 * Math.PI * 15
    
    const updateProgress = () => {
      const articleRect = article.getBoundingClientRect()
      const articleTop = articleRect.top + window.scrollY
      const articleHeight = articleRect.height
      const windowHeight = window.innerHeight
      const scrolled = window.scrollY - articleTop + windowHeight * 0.3
      
      let progress = Math.max(0, Math.min(100, (scrolled / articleHeight) * 100))
      
      // Show/hide progress bar
      if (window.scrollY > 100) {
        container.classList.remove('opacity-0')
        container.classList.add('opacity-100')
      } else {
        container.classList.add('opacity-0')
        container.classList.remove('opacity-100')
      }
      
      // Update pie chart
      const offset = circumference - (progress / 100) * circumference
      progressPie.style.strokeDashoffset = offset.toString()
    }
    
    let ticking = false
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateProgress()
          ticking = false
        })
        ticking = true
      }
    })
    
    updateProgress()
  })
</script>
